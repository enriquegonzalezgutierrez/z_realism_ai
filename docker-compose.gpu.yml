# path: z_realism_ai/docker-compose.gpu.yml
# description: Hardware Acceleration Layer for NVIDIA GPUs.
#              Enables CUDA support inside the container via Nvidia Container Toolkit.
# author: Enrique González Gutiérrez <enrique.gonzalez.gutierrez@gmail.com>

services:
  z-realism-worker:
    # --- GPU Resource Allocation ---
    # The 'deploy' section allows Docker to map the physical GPU 
    # into the container's namespace.
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              # Capabilities needed for Deep Learning (CUDA)
              capabilities: [gpu]

    # --- Hardware-Specific Environment ---
    environment:
      # Ensures the container sees the GPU.
      - NVIDIA_VISIBLE_DEVICES=all
      # Enables Compute (CUDA) and Utility (smi) drivers.
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      # Explicit flag for the internal Python logic to select "cuda" device.
      - DEVICE_TARGET=cuda