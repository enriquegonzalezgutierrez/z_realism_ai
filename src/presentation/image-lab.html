<!DOCTYPE html>
<html lang="en">
<!-- 
  path: src/presentation/image-lab.html
  description: Static Fusion Module v21.10 - DOM Integrity & Telemetry Fix.
  
  ABSTRACT:
  This module provides a specialized research workspace for transforming 
  2D character manifolds into photorealistic stills. This version ensures 
  the dynamic content (latent preview, final image) does not interfere 
  with the static telemetry overlays (progress bar, viewport label).
  
  ARCHITECTURAL ROLE (Presentation Layer):
  Acts as the primary interface for Static Neural Transformation. It manages 
  asynchronous task orchestration and visually robust real-time telemetry.

  author: Enrique Gonz√°lez Guti√©rrez <enrique.gonzalez.gutierrez@gmail.com>
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z-REALISM | Static Fusion Lab</title>

    <!-- FAVICON CONFIGURATION -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Design System & Laboratory Orchestration -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/lab.css">
</head>
<body>
    <!-- Persistent Cyber-Grid Ambience -->
    <div class="grid-overlay"></div>

    <!-- 
      DYNAMIC NAVIGATION INJECTION: 
      The <nav> is automatically injected by js/nav.js.
    -->

    <!-- Main Laboratory Workspace -->
    <div class="lab-layout">
        
        <!-- LEFT COLUMN: Neural Control Manifold (Sidebar) -->
        <aside class="control-panel">
            
            <!-- 1. SUBJECT IDENTITY (METADATA ANCHOR) -->
            <div class="control-group">
                <label for="char-name">SUBJECT DNA NAME</label>
                <input type="text" id="char-name" class="modern-input" placeholder="e.g., Vegeta, Android 18, Beerus">
            </div>
            
            <!-- 2. SOURCE DATA INGESTION -->
            <div class="upload-zone" id="drop-zone">
                <input type="file" id="file-upload" hidden accept="image/*">
                <div id="file-label">
                    <span class="upload-icon">üìÅ</span>
                    <span class="upload-text">LOAD SOURCE MANIFOLD</span>
                </div>
            </div>

            <!-- 3. SEMANTIC GUIDANCE (STOCHASTIC PROMPT) -->
            <div class="control-group">
                <label for="prompt-input">FEATURE PROMPT GUIDANCE</label>
                <textarea id="prompt-input" class="modern-textarea" placeholder="Describe materials, lighting, and textures...">cinematic lighting, photorealistic skin pores, 8k uhd, masterpiece</textarea>
            </div>

            <!-- 4. PRIMARY NEURAL WEIGHTS -->
            <div class="control-group">
                <label>DENOISING STRENGTH <span id="val-strength">0.65</span></label>
                <input type="range" id="input-strength" min="0.1" max="1.0" step="0.05" value="0.65">
            </div>

            <div class="control-group">
                <label>CN DEPTH WEIGHT <span id="val-depth">0.75</span></label>
                <input type="range" id="input-depth" min="0.0" max="1.5" step="0.05" value="0.75">
            </div>

            <div class="control-group">
                <label>CN CANNY WEIGHT <span id="val-canny">0.70</span></label>
                <input type="range" id="input-canny" min="0.0" max="1.5" step="0.05" value="0.70">
            </div>

            <!-- 5. ADVANCED CONFIGURATION (ACCORDION) -->
            <div class="advanced-accordion">
                <button type="button" class="accordion-trigger" id="adj-trigger">
                    <span>‚öôÔ∏è ADVANCED METADATA</span>
                    <span class="arrow">‚ñº</span>
                </button>
                
                <div class="accordion-content" id="adj-content">
                    
                    <div class="control-group">
                        <label>RESOLUTION ANCHOR <span id="val-res">512</span>px</label>
                        <input type="range" id="input-res" min="512" max="1024" step="64" value="512">
                    </div>

                    <div class="control-group">
                        <label>CFG SCALE <span id="val-cfg">7.5</span></label>
                        <input type="range" id="input-cfg" min="1.0" max="15.0" step="0.5" value="7.5">
                    </div>

                    <div class="control-group">
                        <label>INFERENCE STEPS <span id="val-steps">30</span></label>
                        <input type="range" id="input-steps" min="10" max="60" step="1" value="30">
                    </div>

                    <div class="control-group">
                        <label>STOCHASTIC SEED</label>
                        <input type="number" id="input-seed" class="modern-input" value="42" style="font-family: var(--font-code); font-size: 0.8rem;">
                    </div>

                    <div class="control-group">
                        <label>CANNY LOW THRESHOLD <span id="val-canny-low">100</span></label>
                        <input type="range" id="input-canny-low" min="1" max="255" step="1" value="100">
                    </div>

                    <div class="control-group">
                        <label>CANNY HIGH THRESHOLD <span id="val-canny-high">200</span></label>
                        <input type="range" id="input-canny-high" min="1" max="255" step="1" value="200">
                    </div>
                    
                </div>
            </div>

            <!-- 6. EXECUTION TRIGGERS -->
            <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 10px;">
                <button id="btn-generate" class="btn btn-primary">
                    INITIATE NEURAL FUSION
                </button>
                
                <button id="btn-analyze" class="btn btn-secondary">
                    üîç SEQUENCE DNA STRATEGY
                </button>
            </div>

            <!-- SYSTEM STATUS TELEMETRY -->
            <div id="essence-tag" style="font-family: var(--font-code); font-size: 0.6rem; color: var(--accent); text-align: center; margin-top: 15px; opacity: 0.7; letter-spacing: 1.5px;">
                SYSTEM_STABLE // WAITING_FOR_INPUT
            </div>
        </aside>

        <!-- RIGHT COLUMN: Neural Workspace (Manifold Viewports) -->
        <main class="viewport-area">
            
            <!-- SOURCE INPUT MONITOR (Este no cambia) -->
            <div class="viewport-card" id="source-preview">
                <span class="viewport-label">SOURCE_MANIFOLD_INPUT</span>
                <div style="color: rgba(255,255,255,0.02); font-family: var(--font-code); font-size: 2.5rem; font-weight: 800; letter-spacing: 10px;">
                    NO_DATA
                </div>
            </div>

            <!-- RESULT OUTPUT MONITOR (AQU√ç ES DONDE EST√Å EL CAMBIO) -->
            <div class="viewport-card" id="result-display">
                <span class="viewport-label">ACTIVE_INFERENCE_MONITOR</span>
                
                <!-- ESTE BLOQUE TELEMETRY_HUD DEBE IR JUSTO AQU√ç, DENTRO DE #result-display -->
                <div id="telemetry-hud" class="telemetry-hud hidden">
                    <div class="hud-row" id="stat-structural">
                        <div class="status-indicator"></div>
                        <span class="hud-label">STR_FIDELITY</span>
                        <span class="hud-value">0%</span>
                    </div>
                    <div class="hud-row" id="stat-identity">
                        <div class="status-indicator"></div>
                        <span class="hud-label">CHR_IDENTITY</span>
                        <span class="hud-value">0%</span>
                    </div>
                    <div class="hud-row" id="stat-realism">
                        <div class="status-indicator"></div>
                        <span class="hud-label">TXT_REALISM</span>
                        <span class="hud-value">0%</span>
                    </div>
                    <div class="hud-separator"></div>
                    <div class="hud-row">
                        <span class="hud-label">INF_TIME</span>
                        <span id="hud-time" class="hud-value-alt">0.0s</span>
                    </div>
                </div>

                <!-- Y este div dynamic-content-viewport DEBE IR DESPU√âS DEL HUD -->
                <div id="dynamic-content-viewport" style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:1;">
                    <div style="color: rgba(255,255,255,0.02); font-family: var(--font-code); font-size: 2.5rem; font-weight: 800; letter-spacing: 10px;">
                        OFFLINE
                    </div>
                </div>

                <!-- The progress overlay is now a sibling and is ALWAYS in the DOM -->
                <div id="progress-overlay" class="progress-overlay hidden" style="z-index:20;">
                    <div class="status-message" id="status-text">CALCULATING_LATENTS...</div>
                    <div class="progress-container">
                        <div class="progress-fill" id="progress-bar"></div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- 
      SHARED ARCHITECTURAL COMPONENTS 
    -->
    <script src="js/nav.js"></script>
    <script src="js/footer.js"></script>
    <script src="js/cookie-consent.js"></script>

    <!-- 
      APPLICATION LOGIC 
    -->
    <script src="js/api.js"></script>
    <script src="js/lab-image.js"></script>
</body>
</html>